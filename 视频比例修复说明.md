# 🎬 视频比例问题修复说明

## 🎯 问题描述
用户反馈：提交参数是纵向的（9:16），但生成的视频是横向的（3:2）。

## 🔧 解决方案

### 1. 参数结构调整
将 `options` 参数直接展开到主请求体中，而不是作为嵌套对象：

```typescript
// 修改前 (嵌套结构)
{
  conversation_id: refConvId,
  prompt,
  options: {
    ratioWidth: 608,
    ratioHeight: 1080
  }
}

// 修改后 (展开结构)
{
  conversation_id: refConvId,
  prompt,
  ratioWidth: 608,
  ratioHeight: 1080,
  generationPattern: 1,
  resolution: 2,
  fps: 60,
  duration: 1
}
```

### 2. 正确的比例设置

#### 📱 纵向视频 (9:16)
```json
{
  "ratioWidth": 608,
  "ratioHeight": 1080
}
```
- 比例计算: 608/1080 ≈ 0.563 (9:16)
- 适用场景: 手机竖屏、短视频平台

#### 🖥️ 横向视频 (16:9)
```json
{
  "ratioWidth": 1080,
  "ratioHeight": 608
}
```
- 比例计算: 1080/608 ≈ 1.777 (16:9)
- 适用场景: 电脑横屏、电视播放

#### ⬜ 正方形视频 (1:1)
```json
{
  "ratioWidth": 720,
  "ratioHeight": 720
}
```
- 比例计算: 720/720 = 1.0 (1:1)
- 适用场景: 社交媒体头像、方形展示

### 3. 完整请求示例

#### 纵向无水印视频
```bash
curl -X POST "http://localhost:8000/v1/videos/generations" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "model": "cogvideox",
    "prompt": "做个纵向动画",
    "label_watermark": 0,
    "image_url": "https://example.com/image.jpg",
    "options": {
      "generationPattern": 1,
      "resolution": 2,
      "fps": 60,
      "duration": 1,
      "ratioWidth": 608,
      "ratioHeight": 1080
    }
  }'
```

### 4. 验证方法

#### 检查生成结果
```javascript
// 响应中的分辨率信息
{
  "data": [{
    "resolution": "9 : 16",  // 应该显示正确比例
    "video_url": "...",
    "cover_url": "..."
  }]
}
```

#### 比例计算验证
```javascript
const ratioWidth = 608;
const ratioHeight = 1080;
const calculatedRatio = ratioWidth / ratioHeight;
console.log('计算比例:', calculatedRatio.toFixed(3)); // 应该约等于 0.563
console.log('标准9:16比例:', (9/16).toFixed(3)); // 0.563
```

## 🧪 测试用例

### 测试1: 纵向视频
```json
{
  "model": "cogvideox",
  "prompt": "做个纵向动画",
  "label_watermark": 0,
  "options": {
    "ratioWidth": 608,
    "ratioHeight": 1080
  }
}
```
**期望结果**: 分辨率显示为 "9 : 16" 或类似纵向比例

### 测试2: 横向视频
```json
{
  "model": "cogvideox",
  "prompt": "做个横向动画",
  "label_watermark": 0,
  "options": {
    "ratioWidth": 1080,
    "ratioHeight": 608
  }
}
```
**期望结果**: 分辨率显示为 "16 : 9" 或类似横向比例

## 🔍 故障排除

### 问题1: 比例仍然不正确
**可能原因**: 
- GLM API 可能有固定的比例选项
- 参数传递格式不正确

**解决方案**:
1. 检查 GLM 官方文档的比例参数格式
2. 尝试使用预设的比例值
3. 验证参数是否正确传递到 API

### 问题2: 参数被忽略
**可能原因**:
- 参数嵌套层级不正确
- 参数名称不匹配 API 要求

**解决方案**:
1. 将 options 参数展开到主请求体
2. 检查 API 日志确认参数传递
3. 对比官方 API 调用格式

## 📝 注意事项

1. **比例限制**: GLM API 可能只支持特定的比例选项
2. **参数优先级**: 某些参数可能会覆盖比例设置
3. **模型限制**: 不同模型可能支持不同的比例范围
4. **分辨率映射**: `resolution: 2` 可能对应特定的像素尺寸

## ✅ 验证清单

- [ ] 参数正确传递到 GLM API
- [ ] 比例计算结果正确
- [ ] 生成视频的实际比例符合预期
- [ ] 无水印功能正常工作
- [ ] 不同比例设置都能正常生成