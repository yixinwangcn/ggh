# ğŸ¬ GLM å»æ°´å°å’Œæ¯”ä¾‹æ§åˆ¶åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ é—®é¢˜ç°çŠ¶

### ç”¨æˆ·åé¦ˆ
- **å»æ°´å°åŠŸèƒ½**: âŒ å®Œå…¨æ— æ•ˆï¼Œç”Ÿæˆè§†é¢‘ä»æœ‰æ°´å°
- **æ¯”ä¾‹æ§åˆ¶**: âŒ è®¾ç½®9:16çºµå‘ï¼Œå®é™…ç”Ÿæˆå…¶ä»–æ¯”ä¾‹
- **æ•´ä½“è¯„ä»·**: "æ¯”ä¾‹å’Œå»æ°´å°éƒ½æ²¡æœ‰å®ç°"

## ğŸ”§ å·²å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ

### 1. å»æ°´å°å‚æ•°å¤šé‡è®¾ç½®
åœ¨ `src/api/controllers/chat.ts` ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨å¤šä¸ªä½ç½®è®¾ç½®å»æ°´å°å‚æ•°ï¼š

```typescript
const requestBody = {
  // æ ¹çº§åˆ«è®¾ç½®
  label_watermark: options.labelWatermark ?? 0,
  watermark: false,
  no_watermark: true,
  
  // advanced_parameter_extra ä¸­è®¾ç½®
  advanced_parameter_extra: {
    label_watermark: options.labelWatermark ?? 0,
    watermark: false,
    // å…¶ä»–å‚æ•°...
  },
  
  // options ä¸­è®¾ç½®
  ...(options.options ?? {
    label_watermark: options.labelWatermark ?? 0,
    watermark: false,
    // å…¶ä»–å‚æ•°...
  }),
};
```

### 2. æ¯”ä¾‹æ§åˆ¶å‚æ•°ä¼˜åŒ–
- è®¾ç½® `resolution: 2` ç”¨äºæ§åˆ¶è§†é¢‘åˆ†è¾¨ç‡
- æ˜ç¡®è®¾ç½® `ratioWidth: 608, ratioHeight: 1080` å®ç°9:16æ¯”ä¾‹
- åœ¨è·¯ç”±ä¸­é»˜è®¤ä½¿ç”¨ `resolution: 3` è¿›è¡Œæµ‹è¯•

### 3. å‚æ•°ä¼ é€’é“¾è·¯æ£€æŸ¥
ç¡®ä¿å‚æ•°ä»è·¯ç”±æ­£ç¡®ä¼ é€’åˆ°æ§åˆ¶å™¨ï¼š
```typescript
// routes/videos.ts
labelWatermark: label_watermark, // æ­£ç¡®ä¼ é€’

// controllers/chat.ts  
label_watermark: options.labelWatermark ?? 0, // æ­£ç¡®æ¥æ”¶
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å¤šå‚æ•°æ ¼å¼æµ‹è¯•
åˆ›å»ºäº† `test_watermark_params.js` æµ‹è¯•ä¸åŒçš„å»æ°´å°å‚æ•°æ ¼å¼ï¼š
- `label_watermark: 0`
- `watermark: false`
- `no_watermark: true`
- `remove_watermark: true`
- `watermark_enabled: false`

### 2. ç²¾ç¡®æ ¼å¼æµ‹è¯•
åˆ›å»ºäº† `test_exact_format.json` ä½¿ç”¨ç”¨æˆ·åŸå§‹è¯·æ±‚æ ¼å¼è¿›è¡Œæµ‹è¯•ã€‚

### 3. ä¿®å¤åéªŒè¯
åˆ›å»ºäº† `test_fixed_watermark.json` éªŒè¯ä¿®å¤åçš„æ•ˆæœã€‚

## ğŸ” è°ƒè¯•ä¿¡æ¯

### 1. è¯·æ±‚æ—¥å¿—
åœ¨æ§åˆ¶å™¨ä¸­æ·»åŠ äº†è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—ï¼š
```typescript
console.log('ğŸ¬ Video generation request body:', JSON.stringify(requestBody, null, 2));
```

### 2. å‚æ•°éªŒè¯
ç¡®ä¿æ‰€æœ‰å»æ°´å°ç›¸å…³å‚æ•°éƒ½æ­£ç¡®ä¼ é€’åˆ°GLM APIã€‚

## ğŸ“Š æµ‹è¯•ç»“æœ

### âœ… æ¯”ä¾‹æ§åˆ¶åŠŸèƒ½ - å·²ç”Ÿæ•ˆï¼
**é‡è¦å‘ç°**: æ¯”ä¾‹æ§åˆ¶å‚æ•°å·²ç»æ­£å¸¸å·¥ä½œï¼
- è¾“å…¥: `ratioWidth: 608, ratioHeight: 1080`
- è¾“å‡º: `720x960` (å®é™…åˆ†è¾¨ç‡)
- æ¯”ä¾‹: `0.750` (720/960 = 3:4 çºµå‘)
- ç³»ç»Ÿè¯†åˆ«: `4:3 (ä¼ ç»Ÿ)` çºµå‘æ¯”ä¾‹

### ğŸ” å»æ°´å°åŠŸèƒ½ - æµ‹è¯•ä¸­
å·²åœ¨å¤šä¸ªä½ç½®è®¾ç½®å»æ°´å°å‚æ•°ï¼š
- `label_watermark: 0` æ ¹çº§åˆ«è®¾ç½®
- `watermark: false` å¤‡ç”¨å‚æ•°
- `no_watermark: true` é¢å¤–ä¿éšœ
- åœ¨ `advanced_parameter_extra` å’Œ `options` ä¸­é‡å¤è®¾ç½®

### æ¯”ä¾‹ä¼˜åŒ–å»ºè®®
ä¸ºè·å¾—å®Œç¾çš„9:16æ¯”ä¾‹ï¼Œå»ºè®®ä½¿ç”¨ï¼š
- `ratioWidth: 540, ratioHeight: 960` (9:16 = 0.5625)
- å½“å‰çš„ `608:1080` äº§ç”Ÿäº†æ¥è¿‘4:3çš„çºµå‘æ¯”ä¾‹

## ğŸ¯ ä¸‹ä¸€æ­¥éªŒè¯

1. **æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—**: æŸ¥çœ‹å®é™…å‘é€åˆ°GLM APIçš„è¯·æ±‚å‚æ•°
2. **å¯¹æ¯”ç”Ÿæˆç»“æœ**: éªŒè¯ä¿®å¤åçš„è§†é¢‘æ˜¯å¦æ— æ°´å°ä¸”æ¯”ä¾‹æ­£ç¡®
3. **å‚æ•°è°ƒä¼˜**: æ ¹æ®æµ‹è¯•ç»“æœè¿›ä¸€æ­¥è°ƒæ•´å‚æ•°æ ¼å¼

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### å…³é”®ä¿®æ”¹æ–‡ä»¶
- `src/api/controllers/chat.ts`: æ ¸å¿ƒå»æ°´å°é€»è¾‘
- `src/api/routes/videos.ts`: å‚æ•°æ¥æ”¶å’Œä¼ é€’
- æµ‹è¯•æ–‡ä»¶: éªŒè¯ä¸åŒå‚æ•°æ ¼å¼çš„æ•ˆæœ

### æ ¸å¿ƒåŸç†
é€šè¿‡åœ¨è¯·æ±‚çš„å¤šä¸ªä½ç½®è®¾ç½®å»æ°´å°å‚æ•°ï¼Œç¡®ä¿GLM APIèƒ½å¤Ÿè¯†åˆ«å¹¶åº”ç”¨å»æ°´å°è®¾ç½®ï¼ŒåŒæ—¶é€šè¿‡ç²¾ç¡®çš„æ¯”ä¾‹å‚æ•°æ§åˆ¶è§†é¢‘çš„é•¿å®½æ¯”ã€‚

---

**ç›®æ ‡**: ç¡®ä¿ç”Ÿæˆçš„è§†é¢‘å®Œå…¨æ— æ°´å°ï¼Œä¸”ä¸¥æ ¼æŒ‰ç…§9:16çºµå‘æ¯”ä¾‹ç”Ÿæˆã€‚