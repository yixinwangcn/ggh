# 🎯 GLM 视频比例问题分析

## 🔍 问题现状

### 测试结果
- **设置参数**: `ratioWidth: 608, ratioHeight: 1080` (9:16)
- **实际结果**: `resolution: "3 : 2"` (横向)
- **去水印状态**: ✅ 正常 (`label_watermark: 0` 生效)

### 问题分析
1. `ratioWidth/ratioHeight` 参数可能不是GLM API的标准参数
2. `resolution: 2` 可能对应固定的比例设置
3. GLM API可能使用不同的比例控制机制

## 🧪 可能的解决方案

### 方案1: 修改resolution参数
GLM可能使用resolution的不同值来表示不同比例：
- `resolution: 1` → 可能是某种比例
- `resolution: 2` → 当前得到3:2 (横向)
- `resolution: 3` → 可能是9:16 (纵向)
- `resolution: 4` → 可能是其他比例

### 方案2: 使用标准比例参数
可能的参数名：
- `aspect_ratio: "9:16"`
- `video_ratio: "portrait"`
- `orientation: "vertical"`
- `format: "9:16"`

### 方案3: 检查GLM官方API文档
需要确认GLM CogVideoX的官方比例参数格式

## 🔧 测试计划

### 1. Resolution值测试
```javascript
// 测试不同resolution值
const tests = [
  { resolution: 1 },
  { resolution: 2 }, // 当前默认，得到3:2
  { resolution: 3 },
  { resolution: 4 },
  { resolution: 5 }
];
```

### 2. 比例参数测试
```javascript
// 测试可能的比例参数
const aspectTests = [
  { aspect_ratio: '9:16' },
  { ratio: 'portrait' },
  { video_format: 'vertical' }
];
```

## 📊 GLM API 可能的比例映射

基于常见的视频API设计，可能的映射关系：

| resolution | 可能对应的比例 | 说明 |
|------------|---------------|------|
| 1 | 16:9 | 标准横向 |
| 2 | 3:2 | 当前测试结果 |
| 3 | 9:16 | 标准纵向 |
| 4 | 1:1 | 正方形 |
| 5 | 4:3 | 传统比例 |

## 🎯 推荐解决方案

### 立即尝试
1. **修改默认resolution**: 将默认值从2改为3
2. **添加比例映射**: 根据用户需求自动选择resolution值
3. **保留ratioWidth/Height**: 作为备用参数

### 代码修改建议
```typescript
// 根据比例自动选择resolution
function getResolutionByRatio(ratioWidth: number, ratioHeight: number): number {
  const ratio = ratioWidth / ratioHeight;
  
  if (ratio < 0.7) {
    return 3; // 可能对应9:16纵向
  } else if (ratio > 1.5) {
    return 1; // 可能对应16:9横向
  } else if (Math.abs(ratio - 1) < 0.1) {
    return 4; // 可能对应1:1正方形
  } else {
    return 2; // 默认值
  }
}
```

## 🔍 下一步行动

1. **测试resolution=3**: 看是否得到9:16比例
2. **分析服务器日志**: 确认参数正确传递
3. **对比官方文档**: 查找正确的比例参数
4. **实现智能映射**: 根据ratioWidth/Height自动选择resolution

## 💡 临时解决方案

如果无法找到正确的比例参数，可以：
1. **文档说明**: 告知用户当前比例限制
2. **预设选项**: 提供几种固定比例选择
3. **后处理**: 在视频生成后进行比例调整（如果可能）

---

**结论**: 需要进一步测试不同的resolution值和可能的比例参数，以找到控制GLM视频比例的正确方法。